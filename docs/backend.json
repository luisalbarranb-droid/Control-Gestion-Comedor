
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Name of the user."
        },
        "role": {
          "type": "string",
          "description": "Role of the user (superadmin, admin, comun)."
        },
        "area": {
          "type": "string",
          "description": "Area the user belongs to. (Reference to Area)"
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the user is active."
        },
        "creationDate": {
          "type": "string",
          "description": "Date and time the user was created.",
          "format": "date-time"
        },
        "createdBy": {
          "type": "string",
          "description": "User ID of the user who created this user. (Reference to User)"
        },
        "lastAccess": {
          "type": "string",
          "description": "Date and time of the user's last access.",
          "format": "date-time"
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the user (optional)."
        },
        "fechaIngreso": {
          "type": "string",
          "format": "date-time",
          "description": "The user's start date in the company."
        },
        "diasContrato": {
          "type": "number",
          "description": "Duration of the contract in days (if applicable)."
        },
        "fechaNacimiento": {
          "type": "string",
          "format": "date",
          "description": "The user's date of birth."
        },
        "avatarUrl": {
          "type": "string",
          "format": "uri",
          "description": "URL of the user's profile picture."
        },
        "monthlyPoints": {
            "type": "number",
            "description": "Points accumulated by the user during the current month for recognition programs."
        },
        "recognitions": {
            "type": "array",
            "description": "List of recognitions or awards received by the user, e.g., 'employee_of_the_month_YYYY-MM'.",
            "items": {
                "type": "string"
            }
        }
      },
      "required": [
        "id",
        "email",
        "name",
        "role",
        "area",
        "isActive",
        "creationDate",
        "createdBy"
      ]
    },
    "Area": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Area",
      "type": "object",
      "description": "Represents an area within the organization.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the area (service, cocina, limpieza, almacen, equipos, administracion)."
        },
        "name": {
          "type": "string",
          "description": "Name of the area."
        },
        "color": {
          "type": "string",
          "description": "Color associated with the area."
        },
        "responsible": {
          "type": "string",
          "description": "User ID of the user responsible for the area. (Reference to User)"
        },
        "description": {
          "type": "string",
          "description": "Description of the area."
        },
        "isActive": {
          "type": "boolean",
          "description": "Indicates if the area is active."
        }
      },
      "required": [
        "id",
        "name",
        "color",
        "responsible",
        "description",
        "isActive"
      ]
    },
    "Task": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Task",
      "type": "object",
      "description": "Represents a task in the system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the task."
        },
        "title": {
          "type": "string",
          "description": "Title of the task."
        },
        "description": {
          "type": "string",
          "description": "Description of the task."
        },
        "area": {
          "type": "string",
          "description": "Area the task belongs to. (Reference to Area)"
        },
        "assignedTo": {
          "type": "string",
          "description": "User ID of the user assigned to the task. (Reference to User)"
        },
        "createdBy": {
          "type": "string",
          "description": "User ID of the user who created the task. (Reference to User)"
        },
        "status": {
          "type": "string",
          "description": "Status of the task (pendiente, en-progreso, completada, verificada, rechazada)."
        },
        "priority": {
          "type": "string",
          "description": "Priority of the task (baja, media, alta, urgente)."
        },
        "periodicity": {
          "type": "string",
          "description": "Periodicity of the task (diaria, semanal, quincenal, mensual, unica)."
        },
        "creationDate": {
          "type": "string",
          "description": "Date and time the task was created.",
          "format": "date-time"
        },
        "dueDate": {
          "type": "string",
          "description": "Date and time the task is due.",
          "format": "date-time"
        },
        "completionDate": {
          "type": "string",
          "description": "Date and time the task was completed.",
          "format": "date-time"
        },
        "nextExecution": {
          "type": "string",
          "description": "Date and time of the next execution for recurring tasks.",
          "format": "date-time"
        },
        "checklist": {
          "type": "array",
          "description": "Checklist items for the task.",
          "items": {
            "type": "string"
          }
        },
        "evidenceIds": {
          "type": "array",
          "description": "References to Evidences. (Relationship: Task 1:N Evidence)",
          "items": {
            "type": "string"
          }
        },
        "commentIds": {
          "type": "array",
          "description": "References to Comments. (Relationship: Task 1:N Comment)",
          "items": {
            "type": "string"
          }
        },
        "estimatedTime": {
          "type": "number",
          "description": "Estimated time for the task in minutes."
        },
        "tags": {
          "type": "array",
          "description": "Tags associated with the task.",
          "items": {
            "type": "string"
          }
        },
        "isRecurring": {
          "type": "boolean",
          "description": "Indicates if the task is recurring."
        },
        "parentId": {
          "type": "string",
          "description": "Task ID of the parent task for recurring tasks. (Reference to Task)"
        },
        "qualityScore": {
            "type": "number",
            "description": "Supervisor's rating of the task quality (1-5)."
        },
        "effortScore": {
            "type": "number",
            "description": "Supervisor's rating of the effort put in (1-5)."
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "area",
        "assignedTo",
        "createdBy",
        "status",
        "priority",
        "periodicity",
        "creationDate",
        "dueDate"
      ]
    },
    "Statistic": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Statistic",
      "type": "object",
      "description": "Represents statistics for a given period.",
      "properties": {
        "period": {
          "type": "string",
          "description": "Period for the statistics (YYYY-MM)."
        },
        "totalTasks": {
          "type": "number",
          "description": "Total number of tasks."
        },
        "completedTasks": {
          "type": "number",
          "description": "Number of completed tasks."
        },
        "pendingTasks": {
          "type": "number",
          "description": "Number of pending tasks."
        },
        "delayedTasks": {
          "type": "number",
          "description": "Number of delayed tasks."
        },
        "generalEfficiency": {
          "type": "number",
          "description": "General efficiency percentage."
        },
        "efficiencyByArea": {
          "type": "array",
          "description": "Efficiency by area.",
          "items": {
            "type": "string"
          }
        },
        "efficiencyByUser": {
          "type": "array",
          "description": "Efficiency by user.",
          "items": {
            "type": "string"
          }
        },
        "monthlyTrend": {
          "type": "number",
          "description": "Monthly trend percentage change vs previous month."
        },
        "criticalAreas": {
          "type": "array",
          "description": "Area IDs of critical areas with lower efficiency. (Reference to Area)",
          "items": {
            "type": "string"
          }
        },
        "featuredUsers": {
          "type": "array",
          "description": "User IDs of featured users with higher efficiency. (Reference to User)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "period",
        "totalTasks",
        "completedTasks",
        "pendingTasks",
        "delayedTasks",
        "generalEfficiency"
      ]
    },
    "Configuration": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Configuration",
      "type": "object",
      "description": "Represents system configuration settings.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the configuration (e.g., 'sistema')."
        },
        "periodicities": {
          "type": "array",
          "description": "List of periodicities.",
          "items": {
            "type": "string"
          }
        },
        "priorities": {
          "type": "array",
          "description": "List of priorities.",
          "items": {
            "type": "string"
          }
        },
        "statuses": {
          "type": "array",
          "description": "List of statuses.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id"
      ]
    },
    "Evidence": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Evidence",
      "type": "object",
      "description": "Represents photo evidence for a task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the evidence."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N Evidence)"
        },
        "url": {
          "type": "string",
          "description": "URL of the photo."
        },
        "fileName": {
          "type": "string",
          "description": "Name of the file."
        },
        "uploadDate": {
          "type": "string",
          "description": "Date and time the photo was uploaded.",
          "format": "date-time"
        },
        "userId": {
          "type": "string",
          "description": "User ID who uploaded the photo. (Reference to User)"
        },
        "description": {
          "type": "string",
          "description": "Description of the photo."
        }
      },
      "required": [
        "id",
        "url",
        "fileName",
        "uploadDate",
        "userId"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a task.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the comment."
        },
        "taskId": {
          "type": "string",
          "description": "Reference to Task. (Relationship: Task 1:N Comment)"
        },
        "userId": {
          "type": "string",
          "description": "User ID who made the comment. (Reference to User)"
        },
        "message": {
          "type": "string",
          "description": "Comment message."
        },
        "date": {
          "type": "string",
          "description": "Date and time the comment was made.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of comment (comentario, advertencia, elogio)."
        }
      },
      "required": [
        "id",
        "userId",
        "message",
        "date",
        "type"
      ]
    },
    "InventoryItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Inventory Item",
      "type": "object",
      "description": "Represents an item in the inventory.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the inventory item."
        },
        "nombre": {
          "type": "string",
          "description": "Name of the item."
        },
        "descripcion": {
          "type": "string",
          "description": "Description of the item."
        },
        "categoriaId": {
          "type": "string",
          "description": "Category of the item (carnes, viveres, etc.)."
        },
        "cantidad": {
          "type": "number",
          "description": "Current quantity in stock."
        },
        "unidad": {
          "type": "string",
          "description": "Unit of measure (kg, g, lt, ml, unidad, etc.)."
        },
        "stockMinimo": {
          "type": "number",
          "description": "Minimum stock level before reorder warning."
        },
        "fechaCreacion": {
          "type": "string",
          "format": "date-time",
          "description": "Date the item was first added."
        },
        "ultimaActualizacion": {
          "type": "string",
          "format": "date-time",
          "description": "Last time the item was updated."
        },
        "proveedor": {
          "type": "string",
          "description": "Default supplier for the item."
        },
        "costoUnitario": {
          "type": "number",
          "description": "Cost per unit of the item."
        }
      },
      "required": [
        "id",
        "nombre",
        "categoriaId",
        "cantidad",
        "unidad",
        "stockMinimo",
        "fechaCreacion",
        "ultimaActualizacion"
      ]
    },
    "Menu": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Menu",
      "type": "object",
      "description": "Represents a planned menu for a specific date.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the menu."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The date for which the menu is planned."
        },
        "pax": {
          "type": "number",
          "description": "Number of people (comensales) the menu is planned for."
        },
        "items": {
          "type": "array",
          "description": "List of menu items for this menu.",
          "items": {
            "$ref": "#/backend/entities/MenuItem"
          }
        }
      },
      "required": [
        "id",
        "date",
        "pax"
      ]
    },
    "MenuItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Menu Item",
      "type": "object",
      "description": "Represents a single dish or item within a menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the menu item."
        },
        "name": {
          "type": "string",
          "description": "Name of the dish."
        },
        "category": {
          "type": "string",
          "description": "Category of the dish (e.g., entrada, proteico)."
        },
        "ingredients": {
          "type": "array",
          "description": "List of ingredients required for this dish.",
          "items": {
            "$ref": "#/backend/entities/Ingredient"
          }
        }
      },
      "required": [
        "id",
        "name",
        "category"
      ]
    },
    "Ingredient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Ingredient",
      "type": "object",
      "description": "Represents an ingredient required for a menu item.",
      "properties": {
        "inventoryItemId": {
          "type": "string",
          "description": "Reference to the InventoryItem."
        },
        "quantity": {
          "type": "number",
          "description": "Net quantity per person required."
        },
        "wasteFactor": {
          "type": "number",
          "description": "Waste factor percentage (0 to 1)."
        }
      },
      "required": [
        "inventoryItemId",
        "quantity",
        "wasteFactor"
      ]
    },
    "AttendanceRecord": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Attendance Record",
      "type": "object",
      "description": "Represents a single attendance record for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the record."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user this record belongs to."
        },
        "checkIn": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the check-in event."
        },
        "checkOut": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp of the check-out event (optional)."
        },
        "status": {
          "type": "string",
          "enum": ["presente", "ausente", "retardo", "fuera-de-horario", "justificado", "no-justificado", "vacaciones", "dia-libre"],
          "description": "The status of the attendance for that day."
        },
        "leaveType": {
          "type": "string",
          "enum": ["justificado", "no-justificado", "vacaciones"],
          "description": "If the status is a leave of absence, this specifies the type."
        }
      },
      "required": ["id", "userId", "checkIn", "status"]
    },
    "DayOff": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Day Off",
      "type": "object",
      "description": "Represents a planned day off for a user for a specific week.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier, usually in the format {userId}_{weekStartDate}."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user this day off belongs to."
        },
        "weekStartDate": {
          "type": "string",
          "format": "date",
          "description": "The start date of the week (Monday) for which this day off is planned (YYYY-MM-DD)."
        },
        "dayOff": {
          "type": "number",
          "description": "The day of the week for the day off (0=Monday, 1=Tuesday, ..., 5=Saturday)."
        }
      },
      "required": ["id", "userId", "weekStartDate", "dayOff"]
    },
    "PeerReview": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Peer Review",
        "type": "object",
        "description": "Represents a peer-to-peer review on a specific task.",
        "properties": {
            "id": {
                "type": "string",
                "description": "Unique identifier for the review."
            },
            "reviewerId": {
                "type": "string",
                "description": "User ID of the person giving the review."
            },
            "revieweeId": {
                "type": "string",
                "description": "User ID of the person being reviewed."
            },
            "taskId": {
                "type": "string",
                "description": "The task associated with this review."
            },
            "rating": {
                "type": "string",
                "enum": ["positive", "neutral", "negative"],
                "description": "The peer's rating of the task execution."
            },
            "comment": {
                "type": "string",
                "description": "An optional comment from the peer."
            },
            "date": {
                "type": "string",
                "format": "date-time",
                "description": "Date and time the review was submitted."
            }
        },
        "required": ["id", "reviewerId", "revieweeId", "taskId", "rating", "date"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user information. Path-based ownership ensures only the user or an admin can access user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/areas/{areaId}",
        "definition": {
          "entityName": "Area",
          "schema": {
            "$ref": "#/backend/entities/Area"
          },
          "description": "Stores area information.",
          "params": [
            {
              "name": "areaId",
              "description": "The unique identifier of the area."
            }
          ]
        }
      },
      {
        "path": "/tasks/{taskId}",
        "definition": {
          "entityName": "Task",
          "schema": {
            "$ref": "#/backend/entities/Task"
          },
          "description": "Stores task information. Includes denormalized 'area' and 'assignedTo' fields for authorization independence.",
          "params": [
            {
              "name": "taskId",
              "description": "The unique identifier of the task."
            }
          ]
        }
      },
      {
        "path": "/statistics/{period}",
        "definition": {
          "entityName": "Statistic",
          "schema": {
            "$ref": "#/backend/entities/Statistic"
          },
          "description": "Stores statistics for a given period.",
          "params": [
            {
              "name": "period",
              "description": "The period for the statistics (YYYY-MM)."
            }
          ]
        }
      },
      {
        "path": "/configuration/{id}",
        "definition": {
          "entityName": "Configuration",
          "schema": {
            "$ref": "#/backend/entities/Configuration"
          },
          "description": "Stores system configuration settings.",
          "params": [
            {
              "name": "id",
              "description": "The unique identifier for the configuration."
            }
          ]
        }
      },
      {
        "path": "/evidences/{evidenceId}",
        "definition": {
          "entityName": "Evidence",
          "schema": {
            "$ref": "#/backend/entities/Evidence"
          },
          "description": "Stores evidence for tasks. Includes denormalized 'taskId' for authorization independence.",
          "params": [
            {
              "name": "evidenceId",
              "description": "The unique identifier for the evidence."
            }
          ]
        }
      },
      {
        "path": "/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments for tasks.",
          "params": [
            {
              "name": "commentId",
              "description": "The unique identifier for the comment."
            }
          ]
        }
      },
      {
        "path": "/inventory/{itemId}",
        "definition": {
          "entityName": "InventoryItem",
          "schema": {
            "$ref": "#/backend/entities/InventoryItem"
          },
          "description": "Stores individual inventory items.",
          "params": [
            {
              "name": "itemId",
              "description": "The unique identifier for the inventory item."
            }
          ]
        }
      },
      {
        "path": "/menus/{menuId}",
        "definition": {
          "entityName": "Menu",
          "schema": {
            "$ref": "#/backend/entities/Menu"
          },
          "description": "Stores the planned menus for each day.",
          "params": [
            {
              "name": "menuId",
              "description": "The unique identifier for the menu."
            }
          ]
        }
      },
      {
        "path": "/attendance/{recordId}",
        "definition": {
          "entityName": "AttendanceRecord",
          "schema": {
            "$ref": "#/backend/entities/AttendanceRecord"
          },
          "description": "Stores individual attendance records for each user check-in/out.",
          "params": [
            {
              "name": "recordId",
              "description": "The unique identifier for the attendance record."
            }
          ]
        }
      },
      {
        "path": "/daysOff/{dayOffId}",
        "definition": {
          "entityName": "DayOff",
          "schema": {
            "$ref": "#/backend/entities/DayOff"
          },
          "description": "Stores the planned weekly day off for each user.",
          "params": [
            {
              "name": "dayOffId",
              "description": "The unique identifier for the day off record, combining userId and week start date."
            }
          ]
        }
      },
      {
        "path": "/peer-reviews/{reviewId}",
        "definition": {
          "entityName": "PeerReview",
          "schema": { "$ref": "#/backend/entities/PeerReview" },
          "description": "Stores peer-to-peer feedback on completed tasks.",
          "params": [
              {
                  "name": "reviewId",
                  "description": "The unique identifier of the peer review."
              }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support a task management system with role-based access control. It prioritizes authorization independence through denormalization and structural segregation.  \n\n**Authorization Independence (Denormalization):**\n*   `tasks` collection: The `area` and `assignedTo` fields are present in each task document. This denormalization allows security rules to validate access based on the user's role, the task's assigned area, and the assigned user without needing to perform expensive `get()` operations to retrieve the area or user details from other collections.  The inclusion of `createdBy` also allows for tracing and potential access control based on task creator.\n\n**Structural Segregation:**\n*   User data (`users` collection) is separated from task data (`tasks` collection).  \n*   Area definitions (`areas` collection) are separate from both users and tasks.\n*   Configuration data (`configuration` collection) is separate. This ensures that different types of data with varying access requirements are not mixed in the same collection.\n\n**Access Modeling:**\n*   **Private Data:** The `users` collection follows a path-based ownership model (`/users/{userId}`).\n\n**QAPs (Rules are not Filters):**\n*   Secure `list` operations for tasks are supported because each task document contains the `assignedTo` field. Rules can efficiently filter tasks based on the authenticated user's ID.\n\n**Invariants:**\n*   The structure supports invariants like ownership (through `createdBy` and `assignedTo` in the `tasks` collection) and timestamps (through `creationDate`, `dueDate`, `completionDate` in the `tasks` collection).\n\n**Additional Notes:**\n*   The `statistics` collection is designed to store aggregated data, which can be updated via backend processes. Access to this collection is restricted to admins and superadmins.\n*   The `evidence` and `comments` subcollections are intentionally avoided to minimize read costs when accessing task data. Instead, `evidenceIds` and `commentIds` are used in the `Task` entity to store references to `Evidence` and `Comment` entities which are stored as top-level collections. The `Evidence` collection denormalizes the `taskId` to allow performant security rules.\n*   The `configuration` collection allows storing application-wide settings.\n"
  },
  "storage": {
    "buckets": [
        {
            "name": "profile-pictures",
            "rules": "rules/storage.rules"
        }
    ]
  }
}
